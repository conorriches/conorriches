{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/birdwatching/","result":{"data":{"markdownRemark":{"html":"<p>Let's face it, birdwatching takes time. A <strong>lot</strong> of time.</p>\n<p>And often, when they know you're waiting they won't show up no matter how much bird food you put out. </p>\n<p>So what better to do than to automate the hell out of it? Raspberry Pi's rarely move by their own accord, so they're perfect for setting up without spooking wildlife.</p>\n<h2>Project overview</h2>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/23c9669aaa8fbf1c3f265fd5a855bef3/eea4a/blue.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMEAQL/xAAWAQEBAQAAAAAAAAAAAAAAAAABAAL/2gAMAwEAAhADEAAAAZutYZlHE//EABkQAQEBAAMAAAAAAAAAAAAAAAECAAMSIv/aAAgBAQABBQLM5rCd+Z9zJZ//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPwFX/8QAFhEBAQEAAAAAAAAAAAAAAAAAABES/9oACAECAQE/AYy//8QAGRAAAgMBAAAAAAAAAAAAAAAAABEBAiEQ/9oACAEBAAY/Au7GDqM//8QAHBABAAICAwEAAAAAAAAAAAAAAQARITFBUYGR/9oACAEBAAE/IQDsiUYbq9RL5ID4UcXpMk7n/9oADAMBAAIAAwAAABA0P//EABcRAAMBAAAAAAAAAAAAAAAAAAEQETH/2gAIAQMBAT8QF1P/xAAZEQACAwEAAAAAAAAAAAAAAAAAAREhMXH/2gAIAQIBAT8QSRenB//EABsQAQEAAwEBAQAAAAAAAAAAAAERACExQVGR/9oACAEBAAE/EIiATNkhhIv3CsVTpMmKEKvd5QhabPhzuKpimje/mf/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"A bluetit, caught with the Raspberry Pi HQ camera\"\n        title=\"A bluetit, caught with the Raspberry Pi HQ camera\"\n        src=\"/static/23c9669aaa8fbf1c3f265fd5a855bef3/1c72d/blue.jpg\"\n        srcset=\"/static/23c9669aaa8fbf1c3f265fd5a855bef3/a80bd/blue.jpg 148w,\n/static/23c9669aaa8fbf1c3f265fd5a855bef3/1c91a/blue.jpg 295w,\n/static/23c9669aaa8fbf1c3f265fd5a855bef3/1c72d/blue.jpg 590w,\n/static/23c9669aaa8fbf1c3f265fd5a855bef3/a8a14/blue.jpg 885w,\n/static/23c9669aaa8fbf1c3f265fd5a855bef3/fbd2c/blue.jpg 1180w,\n/static/23c9669aaa8fbf1c3f265fd5a855bef3/eea4a/blue.jpg 1280w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">A bluetit, caught with the Raspberry Pi HQ camera</figcaption>\n  </figure></p>\n<p>We are going to use a Raspberry Pi with an HQ Camera, paired with TensorFlow Lite machine learning to identify when there's a bird infront of the camera, and take a photo when it sees one.</p>\n<p>The camera should be facing something like a birdbath, feeder, or table where birds are likely to visit when left alone. </p>\n<p>We are going to use the new <a href=\"https://www.raspberrypi.com/documentation/accessories/camera.html#libcamera-and-libcamera-apps\">libcamera</a> stack - so make sure you have a recent version of Raspberry Pi OS installed and everyting is up to date. </p>\n<div style=\"clear:both\"></div>\n<h2>Parts required</h2>\n<ul>\n<li>A Raspberry Pi, with up-to-date OS, connected to</li>\n<li>Pi HQ Camera, with a</li>\n<li>16mm lens, mounted on a </li>\n<li>tripod</li>\n</ul>\n<p>There's no coding needed to get it up and running, but some proficiency with Raspberry Pi will come in handy.</p>\n<h2>Prerequisites</h2>\n<p>This guide doesn't cover everything, so here's some good things to start with:</p>\n<ul>\n<li>Setting up a Raspbery Pi</li>\n<li><a href=\"https://www.raspberrypi.com/documentation/accessories/camera.html#installing-a-raspberry-pi-camera\">Installing a Raspberry Pi camera</a></li>\n<li>Enabling ssh</li>\n<li>Basic linux commands</li>\n</ul>\n<hr>\n<h2>Step one - get the camera working and set up</h2>\n<p>First of all, install the camera module, and boot the Raspberry Pi. Use a screen for this step.\n<figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d9fea988834fadb2bff7bd72e909ef2d/72e01/water.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMBBP/EABYBAQEBAAAAAAAAAAAAAAAAAAIBA//aAAwDAQACEAMQAAABmnhtHCWf/8QAGxAAAgMAAwAAAAAAAAAAAAAAAAIBERITFCH/2gAIAQEAAQUCsaKXLHKkHY81Z//EABcRAAMBAAAAAAAAAAAAAAAAAAEDEGH/2gAIAQMBAT8BK9n/xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPwEZ/8QAGhAAAgIDAAAAAAAAAAAAAAAAAAECERAhkf/aAAgBAQAGPwITxqylHpbbP//EABoQAQADAQEBAAAAAAAAAAAAAAEAESFRMbH/2gAIAQEAAT8hu0+uzeBt3dIvT9SdTMUHYttFn//aAAwDAQACAAMAAAAQpD//xAAWEQADAAAAAAAAAAAAAAAAAAAAASH/2gAIAQMBAT8QQqKf/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERQf/aAAgBAgEBPxDBoh//xAAeEAEAAgICAwEAAAAAAAAAAAABABEhMVGBYZGh0f/aAAgBAQABPxBZoMFxfH2Ka/GOA2wEK1si+4sw6v1iHp7yA15qotdbErB3P//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"bird.exe has stopped unexpectedly\"\n        title=\"bird.exe has stopped unexpectedly\"\n        src=\"/static/d9fea988834fadb2bff7bd72e909ef2d/1c72d/water.jpg\"\n        srcset=\"/static/d9fea988834fadb2bff7bd72e909ef2d/a80bd/water.jpg 148w,\n/static/d9fea988834fadb2bff7bd72e909ef2d/1c91a/water.jpg 295w,\n/static/d9fea988834fadb2bff7bd72e909ef2d/1c72d/water.jpg 590w,\n/static/d9fea988834fadb2bff7bd72e909ef2d/a8a14/water.jpg 885w,\n/static/d9fea988834fadb2bff7bd72e909ef2d/72e01/water.jpg 1024w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">bird.exe has stopped unexpectedly</figcaption>\n  </figure></p>\n<p>To test if the camera works use the pre-installed\n<a href=\"https://www.raspberrypi.com/documentation/accessories/camera.html#libcamera-hello\">libcamera-hello</a> by running <code>libcamera-hello -t 0</code></p>\n<ul>\n<li>This will indefinitely show the camera output to the desktop screen</li>\n<li>Play with the camera! </li>\n<li>This is a really fun time to see how the lens works, play with adjustment, focus, light levels etc. </li>\n</ul>\n<p>Save the captured image with <a href=\"https://www.raspberrypi.com/documentation/accessories/camera.html#libcamera-jpeg\">libcamera-jpeg</a> by running <code>libcamera-jpeg -o test.jpg</code>. Practice taking photos and viewing the saved image on the Pi.</p>\n<div style=\"clear:both\"></div>\n<h3>Copying images from the Pi to another device</h3>\n<p>To really enjoy the photos you take with <code>libcamera-jpeg</code> you'll want to copy them to your computer or device. One way is with <code>scp</code>, another is using SFPT.</p>\n<p>To do this you'll need the Pi and other device connected to a WiFi router, SSH enabled on the Pi, and a SSH client on your other device:</p>\n<ul>\n<li>On PC, you can install FileZilla</li>\n<li>On mobile, you can install a SSH/SFTP app</li>\n</ul>\n<p>Once installed:</p>\n<ul>\n<li>Set up a connection to the Pi using the <a href=\"https://www.techworked.com/find-ip-address-of-headless-raspberry-pi/\">Raspberry Pi's IP address</a>. The username/password is the same as when you SSH into the Pi, default is <code>pi</code>/<code>raspberry</code></li>\n<li>Select SFTP</li>\n<li>You should see a file listing when you connect</li>\n</ul>\n<p>Practice copying over photos, it's a bit manual for now but you're now up and running.</p>\n<h2>Step two - install TensorFlow Lite</h2>\n<p>We need a way to detect birds specifically, so we don't get thousands of images of leaves moving. The first step is to install TensorFlow Lite - this is based on machine learning and can be used to identify when there's a bird infront of the camera. It doesn't know what a bird is, but we can later on give it some models and it'll be able to do the magic needed to then use those models to spot a bird.</p>\n<ul>\n<li>Follow <a href=\"https://lindevs.com/install-precompiled-tensorflow-lite-on-raspberry-pi/\">the instructions</a> to install TensorFlow Lite.</li>\n</ul>\n<h2>Step three - rebuild libcamera-apps</h2>\n<p>We can use <a href=\"https://www.raspberrypi.com/documentation/accessories/camera.html#libcamera-detect\">libcamera-detect</a> to open the camera up, and plug into TensorFlow Lite to identify when a bird is on screen.  </p>\n<p>This does not come pre-built, so we will need to build it, folding in our now-installed TensorFlow Lite installation. </p>\n<ul>\n<li>\n<p>Rebuild libcamera-apps</p>\n<ul>\n<li>Start by <a href=\"https://www.raspberrypi.com/documentation/accessories/camera.html#building-libcamera-and-libcamera-apps\">rebuilding libcamera-apps without libcamera</a> </li>\n<li>Run <code>sudo apt install -y libcamera-dev libepoxy-dev libjpeg-dev libtiff5-dev</code> </li>\n</ul>\n</li>\n<li>\n<p>Make sure you continue on to build <a href=\"https://www.raspberrypi.com/documentation/accessories/camera.html#building-libcamera-apps\">libcamera-apps</a></p>\n<p>Install the dependencies: <code>sudo apt install -y cmake libboost-program-options-dev libdrm-dev libexif-dev</code></p>\n<p>Then you'll need to get prepared to build by downloading the code for <code>libcamera-apps</code>:</p>\n<pre><code>cd\ngit clone https://github.com/raspberrypi/libcamera-apps.git\ncd libcamera-apps\nmkdir build\ncd build\n</code></pre>\n</li>\n<li>\n<p>Build it real good</p>\n<ul>\n<li>Run the command:\n<code>cmake .. -DENABLE_DRM=1 -DENABLE_X11=1 -DENABLE_QT=1 -DENABLE_OPENCV=0 -DENABLE_TFLITE=1</code></li>\n<li>This last flag means that your installed TensorFlow Lite is enabled with the build, meaning that <code>libcamera-detect</code> will be able to use it.</li>\n</ul>\n</li>\n<li>\n<p>Finish the process off</p>\n<pre><code>make -j4  # use -j1 on Pi 3 or earlier devices\nsudo make install\nsudo ldconfig\n</code></pre>\n</li>\n</ul>\n<h2>Step Four - when is a bird a bird?</h2>\n<p>So far we have most of the pieces in place but the software still doesn't know what a bird is. Therefore, we need a model which describes what a bird is, and fortunately the hard work is done for us as online there exists a library of common objects which has pre-trained models which we can download.</p>\n<p>Common Objects In Context (COCO) is a machine learning dataset of common objects (including birds) that we can use without having to train up our own model of a bird. From exploring the dataset, it looks like it will work perfectly.</p>\n<p>For example, this image has multiple items identified:\n<a href=\"https://cocodataset.org/#explore?id=12805\">https://cocodataset.org/#explore?id=12805</a></p>\n<p>The context is nothing if not diverse either:\n<a href=\"https://cocodataset.org/#explore?id=43511\">https://cocodataset.org/#explore?id=43511</a></p>\n<h2>Step Five - let's go!</h2>\n<p>We now run the command that will:</p>\n<ul>\n<li>start the camera</li>\n<li>start watching for birds</li>\n<li>take a photo when one is identified</li>\n</ul>\n<p>That's done by running the following command:\n<code>libcamera-detect -t 0 -o birb%04d.jpg --lores-width 400 --lores-height 300 --post-process-file object_detect_tf.json --object bird</code></p>\n<ul>\n<li>\n<p><code>-t 0</code> </p>\n<ul>\n<li>time is zero</li>\n</ul>\n</li>\n<li>\n<p><code>-o birb%04d.jpg</code></p>\n<ul>\n<li>Output file is a 4 digit number that increments. This means you don't have to overwrite images or work out what to name them - it does it for you</li>\n</ul>\n</li>\n<li>\n<p><code>--lores-width</code>/<code>--lores-height</code> </p>\n<ul>\n<li>This is the image sized used by TensorFlow to detect birds. When it recognises a bird, it'll then take a full scale photo.</li>\n</ul>\n</li>\n<li>\n<p><code>--post-process-file object_detect_tf.json</code></p>\n<ul>\n<li>we are telling it what to do</li>\n</ul>\n</li>\n<li>\n<p>--object bird</p>\n<ul>\n<li>telling it what to look out for! </li>\n</ul>\n</li>\n</ul>\n<h2>Moving on...</h2>\n<p>This is just the start of the project, it's rough and ready but works with really good results. </p>\n<p>How about:</p>\n<ul>\n<li>Making it post to Telegram when a bird is identified?</li>\n<li>Making this setup work as a security camera (setting <code>--object person</code>)</li>\n<li>\n<p>Recording a short video when a bird is detected</p>\n<ul>\n<li>How about getting it to pre-record 5s before?</li>\n</ul>\n</li>\n<li>Auto-cropping the image with the bird in the centre?</li>\n<li>Using OpenCV to draw on the images</li>\n</ul>\n<p>There's also a load of other options on the utilities above to play around with.</p>\n<p>And this is all without having to write a script!</p>\n<p>Hope you enjoy your time in the garden with birds!</p>","frontmatter":{"title":"BirbCam™ - Automatic Birdwatching with Raspberry Pi HQ Camera"}}},"pageContext":{"slug":"/blog/birdwatching/"}},"staticQueryHashes":["3682878853","3729204765"]}