{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/access-control/","result":{"data":{"markdownRemark":{"html":"<p>This is a fun project which shows how easy it is to make an entry system with standardised industrial components and a Raspberry Pi.</p>\n<p>The hackerspace has an entry system which has started to show its age - it requires a Pi 1 and occasionally breaks in new and exciting ways. It was therefore time for a new setup, one which was open for people to see how it works, and fix as things inevitably break.</p>\n<p>The benefits of this system is that everything is modular, replaceable, easy to see and understand, easy to upgrade, and highly debuggable. Once it's made to your liking, it can be placed inside an enclosure or, as in my case, mounted in a clear acrylic housing for people to see.</p>\n<h3>Inputs</h3>\n<ul>\n<li>Keypad (4x3 matrix type)</li>\n<li><a href=\"https://www.getkisi.com/guides/wiegand\">Wiegand</a> reader (fob reader, but can be any Wiegand device)</li>\n<li>Request to Exit button</li>\n<li>Doorbell</li>\n</ul>\n<h3>Outputs</h3>\n<ul>\n<li>Two relays\n<ul>\n<li>One for the main lock</li>\n<li>One for a future use - currently operating some lights to illuminate the step into the premises</li>\n</ul>\n</li>\n<li>Beeper and LED for outside</li>\n<li>LED status lights\n<ul>\n<li>Power on</li>\n<li>Run (shows the script is functional and not frozen/stopped)</li>\n<li>Error (illuminates when error logs are written)</li>\n</ul>\n</li>\n</ul>\n<h3>Entry list</h3>\n<p>The system operates based off an entry list. The entry list is a CSV file that contains the permitted users. This file is regularly updated from an external source for this implementation, but can be a static file you write to manually, or you could make a simple CSV editing interface.\nThe main benefit of this approach is that if the internet connection fails when a user attempts to enter, the system will still function as it has a local cache of permitted users. If the entry list hasn't been updated in a while, because of some error fetching an updated version, we can raise an error.</p>\n<h2>Hardware</h2>\n<p>The system is entirely modular with all the different aspects connecting together and bolted to a backboard.\nThis method of mounting components is super maker-friendly, versatile and has a nice finish.</p>\n<h3>Mounting plate / backboard</h3>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAgQA/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQME/9oADAMBAAIQAxAAAAGEh6GjTaR//8QAGhAAAgMBAQAAAAAAAAAAAAAAAAIBERIDIv/aAAgBAQABBQIqbxyMtCo1nqT/xAAVEQEBAAAAAAAAAAAAAAAAAAAQMf/aAAgBAwEBPwGn/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQIBAT8BECf/xAAcEAABBAMBAAAAAAAAAAAAAAAAAREhQRAiUYH/2gAIAQEABj8CkRe1hrSTbwc//8QAHBAAAgMAAwEAAAAAAAAAAAAAAREAITFBUWGB/9oACAEBAAE/IWha+4AKeNRuofYXaqCiR5DQpRD3eZP/2gAMAwEAAgADAAAAELff/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAx/9oACAEDAQE/EHCT/8QAGBEBAQADAAAAAAAAAAAAAAAAAQARIVH/2gAIAQIBAT8QbibnHb//xAAfEAEAAQQBBQAAAAAAAAAAAAABEQAhMUGBUXGhsdH/2gAIAQEAAT8QhaBXE5+eqWARQADk3SyQuy3w0qEuVa2cNWIU7uXXioJMDKMjEs9q/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Connections are made to the Pi via this GPIO screw terminal hat\"\n        title=\"Connections are made to the Pi via this GPIO screw terminal hat\"\n        src=\"/static/696de9043782b79702cf1e6c3c91a32c/1c72d/connections.jpg\"\n        srcset=\"/static/696de9043782b79702cf1e6c3c91a32c/a80bd/connections.jpg 148w,\n/static/696de9043782b79702cf1e6c3c91a32c/1c91a/connections.jpg 295w,\n/static/696de9043782b79702cf1e6c3c91a32c/1c72d/connections.jpg 590w,\n/static/696de9043782b79702cf1e6c3c91a32c/a8a14/connections.jpg 885w,\n/static/696de9043782b79702cf1e6c3c91a32c/fbd2c/connections.jpg 1180w,\n/static/696de9043782b79702cf1e6c3c91a32c/93719/connections.jpg 4000w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Connections are made to the Pi via this GPIO screw terminal hat</figcaption>\n  </figure>\nYou will need:</p>\n<ul>\n<li>backboard made of some stiff material (ideally acrylic)</li>\n<li>2.5mm standoffs and fixings</li>\n<li>(optional) 3mm standoffs and fixings</li>\n</ul>\n<p>The whole system is mounted a backboard. Acrylic is ideal as it can be cut by hand or laser and won't warp, but wood such as plywood, OSB, or even sheet metal will work too.</p>\n<ul>\n<li>The backboard is just to hold the various components which connect to eachother electrically with jumper wires.</li>\n<li>Decide if you want the finished product to be mounted in an enclosure:\n<ul>\n<li>if so, cut your acrylic so that it fits inside the enclosure</li>\n<li>if not, you can make a protective enclosure from acrylic - clear acrylic looks very smart!</li>\n</ul>\n</li>\n<li>The standoffs are so you can safely secure the different items to the backboard without risk of items shorting or touching the backboard.</li>\n<li>If you use mirror acrylic, the standoffs also allow a glimpse under the boards and gives a good effect.</li>\n</ul>\n<div style=\"clear:both\"></div>\n<h3>Connections</h3>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIFA//EABUBAQEAAAAAAAAAAAAAAAAAAAAC/9oADAMBAAIQAxAAAAFNYzxVQkB//8QAGRAAAgMBAAAAAAAAAAAAAAAAAAIBAxES/9oACAEBAAEFApsItGs2dY6Y6c//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPwGq/8QAFhEBAQEAAAAAAAAAAAAAAAAAABES/9oACAECAQE/Aco//8QAGRABAAIDAAAAAAAAAAAAAAAAAAEyEDHh/9oACAEBAAY/AuIxtZZ//8QAGhABAAIDAQAAAAAAAAAAAAAAAQARITFBYf/aAAgBAQABPyFXjB1h7qNYDrk98ocKtxbqf//aAAwDAQACAAMAAAAQCO//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPxBh/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8Qlb//xAAcEAEAAwACAwAAAAAAAAAAAAABABEhMUFhcbH/2gAIAQEAAT8QxEzDPDn3KlehAiyzSFASmBqVPca33NbEAd8XX2Ul5FZP/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"The barrier blocks make the system more resilient to the real world\"\n        title=\"The barrier blocks make the system more resilient to the real world\"\n        src=\"/static/7ad935c3b2bac519d454a17d5047a8c7/1c72d/terminal.jpg\"\n        srcset=\"/static/7ad935c3b2bac519d454a17d5047a8c7/a80bd/terminal.jpg 148w,\n/static/7ad935c3b2bac519d454a17d5047a8c7/1c91a/terminal.jpg 295w,\n/static/7ad935c3b2bac519d454a17d5047a8c7/1c72d/terminal.jpg 590w,\n/static/7ad935c3b2bac519d454a17d5047a8c7/a8a14/terminal.jpg 885w,\n/static/7ad935c3b2bac519d454a17d5047a8c7/fbd2c/terminal.jpg 1180w,\n/static/7ad935c3b2bac519d454a17d5047a8c7/93719/terminal.jpg 4000w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">The barrier blocks make the system more resilient to the real world</figcaption>\n  </figure></p>\n<p>You will need:</p>\n<ul>\n<li><a href=\"https://thepihut.com/products/barrier-terminal-blocks\">Barrier block connector blocks</a></li>\n</ul>\n<p>To interface with the real world can be frustrating when the real world is dirty, and things can move about which can damage delicate wires. To solve this problem, I've used barrier blocks so that all wiring inside the main unit is connected carefully, and then when installed, only the other side of the barrier block screws are used. This way if wires get moved, it won't rip apart the more delicate connections on the boards.</p>\n<p>I've also added labels to the barrier blocks which help with installing and maintaining, as it's clear what each pin does.</p>\n<p>Important Note! If you aren't buffering the GPIOs, which provides a degree of protection from over voltage, it's essential you label and are careful when connecting items.</p>\n<h3>Raspberry Pi</h3>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 286px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 211.48648648648648%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAqCAYAAACz+XvQAAAACXBIWXMAAAsTAAALEwEAmpwYAAAHz0lEQVRIx3WW+VMbVxaF/bdO1dT8MFXZJslkYsexx2NSibGNsQPBZjUGhIlYtYAktAu0ggQS2sAIoQUJiUW7Wt39Tclgs+aVpNfq6nf6nPvuPe/ekWWZT1/pfL4ycnkKYxOklLPsTys5VCiQkkmuj0/r7nDLkIQ6Uq1EC5Gm24X/xVOWFybRvVOw/qybmt2B1H6uXkdqNj+Dtec77Z9Y7ZRI9ZiV0wPijQqtiJLm6q8kLc/Yef43ShNfUN1TU5mfpdwzxu7T52QtFoRVJ81AAFkULwECZVGgIraoiAJ1WULY8VN1a4lbFkiNvOCou4vCsouD4UkKHa9IDY2Qdbup+9ZohCPIknQBeKvkMJSXW6xP7bD3u5GTDi9H7ytUhm3UegdJPeumtOoEtwfRH7gJeHljZCSEeItTxwlhfYLUqJ7Cz2ZOhkVso9N4nrwgMTGJ02Ih7nRR3N1Fuo3hx8CefSAM9eU6/j9j7L/Sc/TYQcMBP37ZQccX/yCpUmH2uPCueUmm928CnjFrzxKc5vhQ2saTX0cdsuDRjOGY6ETn1rCmTbH7co2oQo3dHWFrM00uW0eS5L8AlETk9BabTR/Glp35ihmbfZBVWyd2yYhteJftxxtsjWuwOOP4PAkOsiJnWSPflPwppQ9yeTxuN4YVB9GZWRR3f+TLH//N3gyEH3oJjapZNARYcycpHPCR4ac9uMGQZpVUPk0oHsS/F2N/Wcd05z0e9f2CT5fE9XSe7Wk9rnACbyDOfq5yJUOuAgo1SG+wRZzZjIrB6J+YzK9ZNXZiLGt5m3mByfoUneYpb0LjzBzMs8YmJ4cBjlI2GtXsJ8CzGLQ3q1mGLSGOpWJHX3Ox5nzPkuonxg5eMxEYQat8Qtg0hauyiafoI1KJ02wc06zmkcTmBcM2oFCT2XPAei2K+kjLaGIOq20Anfo+S8U5vvzpa178/Sv2p1XoDVZ8dg/ZRAb5uuTLoO0RleMYDk3MZY24LO/Qqx8wnh1AsTGCbvYZAdU7tFtmHIlVYpVthEaLVqMdNvlCsny+7W0bCRBl9niJsZwWk32AZe1DpvYGGcx0sbj8P6zmXiYLGhaOF1knQGEfshtnYbuaNuc2VE6YKIfH2Asp2H77mPTUI2LhEd5vdzNv+C+r2n4mYvMsZvRsSFuIxQ+A8FHfjVpuj1ZUQ8vdQ8bRT6r/HscTXaQDi+hTwxhN3TjN/WhLNowlK35pAyHhRRaaZ4CXzfGsnmV2jhssrUWYtHtYUS5ge7yETV3kfscrBu5+y+70HIYVGx6Pm1QqhXRJ5Z0blg9sHzWwhlPMeSM4ZxewdljRvocexQCTXQ9ILKiwB7z4g+vsZZOcl/JFpdTrdex2O16vl1AwSPxYwBrPMWx0YRibYuVXG6q5PIqdcczuDvSaZwzEFCizM3gJICR90KhcpE3bfiqVCuVyhUa9/lGyPZpiaWsP/6Ie8yMLyqEq7wwmFgYH2TAqMRQ3cBRDbNb2EKonIImIkvQXkksi2vVthped2JUa3M8dmBZrKPsqeF76sQzMMKyxYQkdEC1KeLxreD0efG7P7bu8ny/iDUZYiX4gotWi6xii7w8jqvEqiw/c+OfUaIMfcCXyRApVTmpVjmoVCrXK7XmYSWfwub2YVp3EZxeYfPAd3z/6Dwb1MYbfTFjfLjBu82GJFQgeCsTrJaL1U/zV4gVD6fNBD/VGnFLZxVbCRFTdR87ZSbYxQzD5hvjyM3aW/mA9tkyx5KHSjLZ976KWb4thS96iKVlJlcwkLW/Y8XxLUHxOlh6yWx2kTb+TOjTSEu20JD+yfOban9OmIDTYqBQJVY+IV0tE2cZUsTMansWg60W9fA9VZZofeu/y+v6/ic1PozNacK26yKSzSJcP+vZF+4DPN2sUW3XKkkCEOLbmKrqaE493gmnTd4xUX/PU/JzRofskDPP4oiGC8SDJ3P4tlXKuWqxA0gbrjTCGhomhmBKtvhuN8S4j+T8YKb1A5/sFjf43BmPvmSmo8OBHCKWhKV4zh7ZjixLisUBU2sF4ZEFbtON1TTBj+Z6B6iveRHtRqh6xYR7HkvXgzLiJlbcRC2UQ5euAIDcE2MqxSZiFYy2KnBazq58F/Q8slJR89eRbur7+ij3VPHabG79zjUwifVXyFcCmCOkSEWn7s2Ov2N4yY/6OvtMuhtJ9zJsf49UNo42YsSUdRKpxxHwJROkWhs0WcvSQLTnG0pGBmZwB28ogWuPPKA5HeX3Yybz9IRZbD8rcEounBtbZpJU6gtZtgEILefeYkBRFnV9i7MMCJtMbpo3f0FN4wsuDDiat32M19jIen0OVWcQvBRGiWRDEv2AYOyTcimE8tbJ46mBldQSjowNVfY6Xuccobfdw2gfQHFlZPrEQkEI3GV5vRTLZLC7XKos2K8HZKYYe/ot//vYN81UFU+Yf0Oue0x9UMJ/X4JM3EOK52xheHAGFQoFkIkHiIMeBzYRuqptu3TCK03HUa08IeafwE2e9uUFM2kHMnNxkeL2bP28nEDcC2G0vebM5xGtPPzrrSxpez3klANKVxbfb18dr6eyNcmqfZNcvhN/2EJ/sZ7+3EyEcumj/Lim7GcNrJ+DHf/lD9vsGCG1/IHaQp6xeQo7Fzp5rv/Taulub9svSpZNT5HD4830xGkXK56+G51Jv839VnMBCmSeMyAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"GPIO pins annotated with what is connected\"\n        title=\"GPIO pins annotated with what is connected\"\n        src=\"/static/9917aa031cdf24caa3d1d4204eef2c22/357e3/pins.png\"\n        srcset=\"/static/9917aa031cdf24caa3d1d4204eef2c22/12f09/pins.png 148w,\n/static/9917aa031cdf24caa3d1d4204eef2c22/357e3/pins.png 286w\"\n        sizes=\"(max-width: 286px) 100vw, 286px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">GPIO pins annotated with what is connected</figcaption>\n  </figure></p>\n<p>You will need:</p>\n<ul>\n<li>A Raspberry Pi (running Raspberry Pi OS, or your favourite OS)</li>\n<li>(Optional) <a href=\"https://thepihut.com/products/gpio-screw-terminal-hat\">A Raspberry Pi Screw Terminal HAT</a></li>\n<li>(Optional) <a href=\"https://thepihut.com/products/raspikey-plug-and-play-emmc-module-for-raspberry-pi\">An EMMC module in place of an SD card</a></li>\n</ul>\n<p>The first thing is getting a EMMC module - this is essentially a SSD in SD card format. It is faster, more reliable and resilient to power outages and file operations.</p>\n<p>The Raspberry Pi is the brains of the system and will control all devices. I've used the GPIO Screw Terminal HAT for connections as I found it gives greater flexibility and ease of use - you can see at a glance what pin each device is connected to. Screw terminals are also more resilient than pin headers, but this is optional.</p>\n<p>You may find there are lots of GPIO pins being required. This can be tricky to keep track of, so I downloaded an image of the Pi GPIO header, then annotated on each pin what I expect to connect to it.</p>\n<p>I also recommend looking and referring to <a href=\"https://pinout.xyz/\">Pinout.xyz</a> to see what each pin does internally. Make note of which pins are used for i2c and keep those free so that they can be used later on if need be.</p>\n<p>It's good practice to group up devices to nearby pins, in this example the keyboard has rows R1-R4 and columns C1-C3 near the bottom of the GPIO. This means that groups of wires go to roughly the same places, and the GPIO header is overall more intuitive to debug.</p>\n<h3>Fob reader</h3>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 586px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 86.48648648648648%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAADz0lEQVQ4y32Ue1BUZRTA70x/9UeNUzP2EEPITMBgggRBXs4OmLViIIIkELuKDZCaFAyQ2cgEM5UZ+coxoEloEsagUIuJhU0Q5LU8FhZBiceyIJNNsCD74PVr7sXdZHQ6M+fec879vt+933lcYXFxEVFMk0b6mjTM3/fFuO2ZzZ+fn7frwsKCpLZ1NhXEoCjtN1r4UJFC/+Cg5Nvi4maTycT/ie1lElAM3J0ycu23aspLKujvH7SDRLl9e4CMrGOkZxzlm3OFFBeXUFmpolt3k7E740xP31sGF8RD9Y+PUXO1hnp1K93dvcuAHZ3dZOccJ/lAGmkZ2SgT38cvcCu+m0OQh0UTG7+fpJTDfPnVaWZmZhCmzGb6Rw1cq1DR8kcr7R3dEmhubk66n//2O5IPppOWdYxDHxxhZ7SCiKh44hTJRO/ZT0SUgkCZHA9PP4aG9Qgmi4Vb+iGul/6KrlFHe4du2RempX9EWHgMfgGhbPKTodybjLqmgfz8YnJyTyCP2IPXpmACgrYyOjqGMGuxoOm7Se3FCoZ6RtBotPZEi4WJT3iXbfJI6YieG4P5NOdrVKoGGurbUKsbcXX3wcnZBVloGH/d/Rvh3tQUBsModbV1DPaO01CnYf5+hScmJsk4kkOwTI6XdzA+fiFkffwF5T/XcDj1E17dGMQqx5dxdHJhR0QMRuMUgtlsZtpoZHDMwOQ/M6irGrFYLRJQ19PL7th9+PjJJJjrK74kv5dJUlIqRRcuEbErAeGxx1n5rCPKxGSs1lkEMfnT01NYzSYWFxdovNHGxIRRAl65WomndyCe3gH4+r/OWxFxvKM8hCAIrFvvwYWiclY7u/GCkwsZmUeX2ka8WMxme1Xb23QYDOOSfebsedy9/HFz90G+I56iokuUlf/O58fPkJ39Gfn5F1nv9hprXnSV1i714QOjJop+eAxtV59k5506J1VRBIZHKvnlcjU/lVVSparnz/5RTp8uZMVTz7HBw5sqVc1/wAfn1mQy09DQLtkHUzPx9AlmW1gUW0LDiFekkHcyn5LSy6jVzSiUB3hyxTP4B4UwrB95GGiDdnXdQq+/Q/EPP/Lm9kiiY/ayPTwWB2dXnnjagbCdsRQUlOLutZnnV68lLiHR3rePBFosVpqbtVitS3nt6tZRUPg9u3bHskX2Brm5J4mO2Yfjug2sXOXEibxT9ul6CGiDGo3TNDV1MDAwgsU8i9Uyh6ZVS0lJBWVlV3g7VomD40usWetKR6fWPl2PBNqg4rBrtT3U1jVRXX2d1tZOqXmXNs/R3tFJS0vrst/Yvy0nJjoCV6ztAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Wiegand readers are potted so are weather resistant\"\n        title=\"Wiegand readers are potted so are weather resistant\"\n        src=\"/static/e579345d1edbf910be2f1ca06146822b/a76f4/wiegand.png\"\n        srcset=\"/static/e579345d1edbf910be2f1ca06146822b/12f09/wiegand.png 148w,\n/static/e579345d1edbf910be2f1ca06146822b/e4a3f/wiegand.png 295w,\n/static/e579345d1edbf910be2f1ca06146822b/a76f4/wiegand.png 586w\"\n        sizes=\"(max-width: 586px) 100vw, 586px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Wiegand readers are potted so are weather resistant</figcaption>\n  </figure></p>\n<p>Important - make sure you get the right type of fob reader!</p>\n<p>There are (at least) two main standards for fob systems:</p>\n<ul>\n<li>125kHz</li>\n<li>13.56mHz</li>\n<li>and others</li>\n</ul>\n<p>While the output of the readers is the same Wiegand protocol, a 125kHz reader won't read a 13.56mHz fob (and likewise the other way round). What type you choose is up to you - 13.56mHz seems to be the more modern option but either will work. If you have fobs already, make sure you get a compatible reader. For this system, which uses fobs which are compatible with NFC, we are using 13.56mHz fobs and readers.</p>\n<p>Note that Wiegand readers are sold often with two descriptors instead of frequencies:</p>\n<ul>\n<li>ID - 125kHz</li>\n<li>IC - 13.56 mHz</li>\n</ul>\n<p>Fob readers and Wiegand devices can be easily bought on sites such as eBay. Most if not all devices require 12v input, which we will deal with further down.</p>\n<p>As the internal circuits are potted, they are weather resistant and can be used outside. Most have a beeper which can be GPIO controlled. This doubles up as the beeper for the keypad as the keypad itself doesn't have any beeper of it's own, and audio feedback when pressing buttons is important. As the two devices will be mounted on a wall near eachother, using the RFID reader beeper for the keypad is acceptable. Some fob readers also have a Green LED which can be GPIO controlled too.</p>\n<h4>Logic Level Voltage Warning</h4>\n<p>Important note! Wiegand readers have two data lines, D0 and D1. They may also have Beep and LED lines which all run at 5V.</p>\n<p>The GPIO voltage for the Pi is 3.3v, so we need a level shifter (module easily bought from eBay) or resistive divider. Because of postal issues in the UK at the moment, I made a resistive divider.</p>\n<p>This connects a 5k resistor from the Wiegand reader to the GPIO pin, then a 10k resistor from the GPIO pin to ground. This means of the 5v the Wiegand reader outputs, some gets sink to ground via the resistors with only 3.3v going to the GPIO.</p>\n<h3>Keypad</h3>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 363px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 114.1891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEX0lEQVQ4y1VVaVNTSRR9//+rlgohe96+72veklUgCRgiJIBIOVXqzPgfztS9QR0/nOqbvO7T564tAMCXL39hPl+ibpo/UNU1qqZG3dRHu64xrkqMyzGK8RHjqkKaZ9gf9kQF4cePH0izAu1eD0EYYjKZoSwrjOlAUSLPC2RZhjzPjzavOX9vJhNohgZFV3HWaePTp0cIz89fmNANPJxfnKOua8ZPUjpcFAXGRcFrMS5Y2XFPiSgOsV6v0O52WL3w9PSMpp6haaaYTmeoqhphFCOMIkRxhCRJWDkhTVOEcYQoiZGkKdIsQxAEWK9W6PSIcAzh6dNn1PUETdNgsVigmTQIogimZcL1XCZ0PQ+6YcB1XWR5hsFgiKE4Qp5nsCwLm/UG3X4XRZlDeHx8RFVV7MJyucRkOuXbF4slHMdGFB1VUhxlRUZR5PB9H5KiwPc9uK6N1WqNXr+LbJxCeHh4+EVICqfTKVrtNl69fg1ZlhGGId6+e4e3796yYlL66s1rtNotZFnKl67Xa/SHfaRFAuH+/p6DS6REOJlM2EXDMlkZJUVWFIiSxHYcx5AUGZZt8xkmXK0xFIdIsgjC4XDgD2VVYUmEVH9VyUjSGEkSo8xTJFEAwzQwaWroigTD0BCGATzfZcKRPEKUBL8Jq7rCcr5AQwd0HZ7nwjRp9RBHAXzPg6IqiMIAo9GAY0Z7CKvVCpIiIox9CPv9nuPHLs/n7LIoiThtncD1HK69VquFk9MTdpnKpN1pQ1Fl1PXR5cvLS/4dhi6E29vb3y7PF2xTDG3b4sNxEsMwTY4jJaisShi6xmqLPIfnObi4uISuq/B950hISaGumM9mvF5fXeP56Qlh6CMIfVxvNphPp9B0lbtit90izVJ4roMw9FihZRpwPQvCbrc7tlhRYDGbs93v9TAY9CHLIsew02nj9PTkl+p+v4tOt40w8PnS1cUlHMuE7Rj/I8xzVkjxJBclReISybOcC5pA++Ik4Xi5rsPd5QcuE3q2DcvWIdzc3KAsXwjnc44h1ZgoilzIQeCza6TWdhykSYx+9wztdgtxHCGOQly+P0fgOjBMFcJ2u+WbqbWIkGZdmiRcb1Q2jmtjt/2AzWrFyrIkhqlKHDPT0JAmEd4vlwh8D7ouQ7i+vj6Op/EYsxeX+4M+Ot0OTNPgXhZHQ4yGg2Mhey7OWicYDHosIooDnJ+fI4wCqJoEYbPZoCjGPElCLtoh+v0eer0ur5Qcsgn0jSCKI0iSCFmR2Auei1EIWRlBuLq64hHU6Z5xG1FWdV2DYejQNJVtUvoTlGlKCO2j+Uj7VI1624IkDSFQ2+iGjixPOSE0NNM04800HCirPExffpOdvTwB9O5Q4c/mM1ZqWRqEb1+/wnVMiMMedFWCqSswDZVXy1AZNkODpatH/Pzf1ODaBjRFhKVJ+Pz0CIFeqn///o673Qfc3nzA/uMWh483ONzuGA/7W9y/4GF/9ycOd8dvdx/xz/dv/Or9B0F5rlQMNHXPAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Vandal resistant keypad that I am using\"\n        title=\"Vandal resistant keypad that I am using\"\n        src=\"/static/b577d3625256dea22ece48f61b75b80d/4e786/keypad.png\"\n        srcset=\"/static/b577d3625256dea22ece48f61b75b80d/12f09/keypad.png 148w,\n/static/b577d3625256dea22ece48f61b75b80d/e4a3f/keypad.png 295w,\n/static/b577d3625256dea22ece48f61b75b80d/4e786/keypad.png 363w\"\n        sizes=\"(max-width: 363px) 100vw, 363px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Vandal resistant keypad that I am using</figcaption>\n  </figure></p>\n<p>It's possible to get combined keypad and fob reader Wiegand devices, but in our case we have these split out.</p>\n<p>The keypad we use is 4x3 in standard telephone layout with 1-3 at the top row through to \"*\", 0 and \"#\" on the bottom rows.</p>\n<p>Note: The keypad I bought had the numbers in reverse order. To put them in correct order, I disassembled the keypad and switched keys around. The only caveat is that the arrows in the new configuration point inwards rather than outwards but this isn't an issue if you're not using arrows.</p>\n<p>The keypad I have also has the word \"enter\" and \"clear\" engraved onto the \"#\" and \"*\" keys respectively.</p>\n<h3>LCD display</h3>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 379px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.972972972972975%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACpElEQVQoz6XR/S8UABzHcb/VD9mkUZqS7awOp8SFizw7T4c77jy04e4SR566KDVFwnl+mIfpgdzskocplR601qq1mKitVm21fmj0Sz+0SeHi3WL9BX1//7y2z+drAbDKKv9z/9ILv35hsbK6AssrPP08Q8OEkcpHFzn3oJ3TY60UjdRz/EYtWUMGMvuryRkwoDNVkdl7nqM9ZWiM5WivlPL4+X2Wlxb5ubiExV/5/cIsrZMDFNRpkFenIK6WISjyYXOuCLtcdxT5vnhnCLHWOGGb6cSWgt1YKe3wShTgqrQl+EwYn7/O8tu8sg7enJ+i6nE3Q2M9ND8ZRN9TQ1hJPP56BbIaHS3GZqqMNYiKQ9mV7YlzoS92yp1kFMdypCyBXfk+TH98u9Z9Dby1+BLDaDtt7Q209V6iqv4CSoUvqigJWSV5HGs1cLKjicRTagIjDyKKdmV7shMZlTno6goIy/Hh1dvptR0t5s0/uPbtHjV95eSr5ehSpcgCHNnvYk2SIoJ0hRRFkBfpCfHEh0jwd7dlj6sNTql7kedGEX7UG3fVNiZmXqyD73jI66VRtOlBZByWEqlKwztSTZDYh/iQ3SSFOqAV7SDJ0ZIQkT0BYmc8pC5YxlqiPZOMvjKbrXIrxicfrYPf+1uYM7UQFyhEneiHTNeINH8Yf88ANHH70MQ40Ojnxo2EcFIPCPEW2eAq2YFLngRtXjBFhWFslG2g87ZxHRzt6+fZ3TuU6JNRq4KJiIrAL1iGv4eAUC97oiQOKMWOyAS2xAS4YSW3RJAm5FBxOMIUZzZHb0KcZMX4uAnz36d8mZsFzExOjTB81YCp6yx9naUM9tbR21mBsauW6z1tDHV30H21jfJbnZwerCfvcik5TSfQVGRR0ajn04c3LJp/8wd9/gR1MRufngAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"LCD display featuring the i2c backpack\"\n        title=\"LCD display featuring the i2c backpack\"\n        src=\"/static/b1241295544d7b065e25af0d17ace468/811d1/lcd.png\"\n        srcset=\"/static/b1241295544d7b065e25af0d17ace468/12f09/lcd.png 148w,\n/static/b1241295544d7b065e25af0d17ace468/e4a3f/lcd.png 295w,\n/static/b1241295544d7b065e25af0d17ace468/811d1/lcd.png 379w\"\n        sizes=\"(max-width: 379px) 100vw, 379px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">LCD display featuring the i2c backpack</figcaption>\n  </figure></p>\n<p>Entirely optional, but I have a soft spot for LCD displays.</p>\n<p>I used one which has a i2c backpack on it, so we only need two data pins to communicate with it rather than the many wires you otherwise need. These are generic devices and can be bought on eBay.</p>\n<p>There's a range of commands that can be used to turn the display on and off, display custom characters, and position text as you please.</p>\n<h3>Relay board</h3>\n<p>Another generic module - these are easily found on eBay and come in many varieties. Make sure to get one which has mounting holes so it can be screwed to the backboard.</p>\n<h3>Powering your system</h3>\n<p>Both Wiegand devices and locks usually require 12v input to run, and some locks may require 24v. Generally you'll start off with a power supply converting mains AC to the higher voltage DC, then reduce down the voltage as needed for different devices.</p>\n<p>You may be able to get a power supply that has multiple voltage outputs. In this case, I'm powering the system with 12v and then converting down to 5v for the Pi. We have a 12v UPS so the system is resilient during a power outage.</p>\n<p>Not that locks can sink a lot of current, so a good power supply is essential.</p>\n<h3>Lock</h3>\n<p>The main component to keep your door secure is a lock. This can be of any type but there are two main categories:</p>\n<ul>\n<li>Fail safe - these locks release if there's a power failure and require power to generate locking force.\n<ul>\n<li>These are good for internal doors</li>\n<li>You may need a green \"break glass\" emergency release wired in series</li>\n<li>Examples are magnetic locks</li>\n</ul>\n</li>\n<li>Fail secure - these locks require power to release. In a power failure, they'll stay locked.\n<ul>\n<li>These are good for external doors.</li>\n<li>You will need some mechanical override so if there's a power cut or the system fails, people can egress</li>\n<li>Examples are gate locks</li>\n</ul>\n</li>\n</ul>\n<p>Consider all relevant regulations and failure scenarios when selecting a lock. The door in question for my project is street-facing, so I'm using a fail secure lock. This lock has a built in mechanical override, as well as a 12v release coil. Therefore it can be released by software for people wishing to enter, and released physically for people inside wishing to egress.</p>\n<h3>Request to exit button</h3>\n<p>This is often a green mushroom button that can be pressed (or often hit) to release the doors. This doesn't interact with the lock wires physically unlike the \"break glass\" emergency buttons. This is a simple push button which the software monitors and releases the lock when pushed.</p>\n<h3>Wires</h3>\n<p>I just used standard jumper wires for all parts of the internal system. For external parts, I used two core flex for the 12v power and locks, for the keypad and Wiegand reader I used alarm cable but you can also use ethernet cable.</p>\n<h3>Status lights</h3>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIEA//EABYBAQEBAAAAAAAAAAAAAAAAAAIAAf/aAAwDAQACEAMQAAABloTcJhDb/8QAHBAAAgICAwAAAAAAAAAAAAAAAQIAAxESBCEi/9oACAEBAAEFAqzYsGXuUeWO54/cuxv/AP/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABURAQEAAAAAAAAAAAAAAAAAABBB/9oACAECAQE/Aaf/xAAbEAABBQEBAAAAAAAAAAAAAAABAAIQESFBkf/aAAgBAQAGPwLR6gTyGWcop0f/xAAbEAADAQADAQAAAAAAAAAAAAABESEAMUFRof/aAAgBAQABPyEuANehc4PEpdaBlNn7jhUkxSUmFQIc3//aAAwDAQACAAMAAAAQmM//xAAXEQADAQAAAAAAAAAAAAAAAAAAAREh/9oACAEDAQE/EJlEsP/EABcRAQEBAQAAAAAAAAAAAAAAAAEAESH/2gAIAQIBAT8Qdq9v/8QAHRABAQABBAMAAAAAAAAAAAAAAREAITFxwUFRgf/aAAgBAQABPxAkPTGxxgCDsCQw1+95FQShynHqET7hRcusAwrfGABoPef/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Status lights show the system at a glance\"\n        title=\"Status lights show the system at a glance\"\n        src=\"/static/323cb767eed6726770dc1a832108701a/1c72d/status.jpg\"\n        srcset=\"/static/323cb767eed6726770dc1a832108701a/a80bd/status.jpg 148w,\n/static/323cb767eed6726770dc1a832108701a/1c91a/status.jpg 295w,\n/static/323cb767eed6726770dc1a832108701a/1c72d/status.jpg 590w,\n/static/323cb767eed6726770dc1a832108701a/a8a14/status.jpg 885w,\n/static/323cb767eed6726770dc1a832108701a/fbd2c/status.jpg 1180w,\n/static/323cb767eed6726770dc1a832108701a/93719/status.jpg 4000w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Status lights show the system at a glance</figcaption>\n  </figure></p>\n<p>I'm a fan of systems being visually intuitive, and so I made three status lights to give an \"at a glance\" overview of the system:</p>\n<p>The top LED (red) is the Error LED, and this flashes when there's content written to the error log (the script just checks the size of error.log every few minutes and then sets an internal variable that is referenced every few ms - this keeps the file from being constantly read).</p>\n<p>The middle LED (green) is the Run LED and this flashes every second so that it's clear the script is running as it's actively controlling the LED. If this LED isn't flashing, the script isn't running!</p>\n<p>The bottom LED (green) is the power LED and is connected to the 3.3v rail on the Pi, this just proves the Pi has power.</p>\n<p>This is just made of veroboard, three LEDs and three resistors.</p>\n<h2>Mounting the hardware</h2>\n<p>This step is as much art as engineering. You can if you wish measure up your boards and design a backplate tailored to the size requirements as I did, or you can roughly place the items and see what looks good.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.1891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC20lEQVQ4y3WRS28TZxSG5ydV7X+oKnUBa4rBxqgR6raqSqVKiFUxRFU3SLRCqlS1le+XxPEECLFJ7LGN756Lx44dYydO0kpVSoJvY/upvgkEsuji0ZnvnPne7z3nSMemyaizy7TbY9brM3vVwxLs9pjudhl2OgzbbUbtDtNuF6v76gLi7lDQ2mE8OEA6yWSZGyp7mU2am5u0Uy/op1P08kkGxZdYusG0UmVcqdLP59lVFLpK1qajKJxWa1hGg0mxxKxhIo10k6OqwoM/7+Nc/pbP7yzx2Xdf4PnjAaahMdZ0+8JpXUWOxwlGIkSiUZtAJMxRqcS8YTKuq1j7A6ShrvNPsYzr17v8npe588syH9+6jMPzDS8yz5kIQd2wBZ8lEsRWYsRXV22isRh/lcq24KRWx9rfRxoZDf4uFbn041d8dM/BJ/eu8+n3Li7/cIvk9gZTzcAyzgQTq3EC4TDhaIRwNIovHOKo+IFDMcM3hTL/qi8Jyo/5KfSY5cAjfgv+zMPgfcrKlt3utK4yqtVoKVn07TSN9Bni+7VwJhyWK1g7baQTMUzDALMJZgsMk7nRYKYbDOs1pmIpdZVJXaWYTJJ68oTtp89Irq8zKBRZCDHdYFKpYnU6SCeazlTTGQoXqkA7R8xvLKJu2OfnsmwvY3VlhXAkQjOdsec70nT7QbvlE1WFhgmtnf9FuLA7aLZYNFsX4rt/LFU72/KpqtHP5ijE1ygnZEprCUqJt6ytUZZlerk8ZipFOZGgIq9TldepyLKNyNU3NnhdqTLb20caFoqEvV6uOBy4b97E6XLhcrttrjudfLm0RCwSwePxcOXq1fOa84aLG243jmvX+Pr2bfaULItmE+m0VmdvO82Wz0c2FCLjD5ALhciFwmx5faT9AQ6yOXSxDJ+ftN+PEgjatS2v184VYjGGYsu9PtKbfh8Oj5gfHLI4PDyPi7e59+cP6xdrc8HggNnxMf8BCM9peNA1Xb4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"My initial design for the backboard including mounting holes\"\n        title=\"My initial design for the backboard including mounting holes\"\n        src=\"/static/ae17b90cb8f049d6c658c701f211f5f7/fcda8/backboard.png\"\n        srcset=\"/static/ae17b90cb8f049d6c658c701f211f5f7/12f09/backboard.png 148w,\n/static/ae17b90cb8f049d6c658c701f211f5f7/e4a3f/backboard.png 295w,\n/static/ae17b90cb8f049d6c658c701f211f5f7/fcda8/backboard.png 590w,\n/static/ae17b90cb8f049d6c658c701f211f5f7/efc66/backboard.png 885w,\n/static/ae17b90cb8f049d6c658c701f211f5f7/4c42d/backboard.png 896w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">My initial design for the backboard including mounting holes</figcaption>\n  </figure></p>\n<p>Be sure to leave plenty of space between items for wires to go.</p>\n<p>Once you have everything vaguely placed, use a pen such as a Sharpie to mark where holes should go. You can measure things out if you want things aligned, or just eyeball each board's placement. Use a 2.5mm or 3mm drill bit depending on what size hole each item has.</p>\n<p>The Raspberry Pi \"B\" boards all have 2.5mm holes, so a 2.5mm hole on the backboard, and then 2.5mm spacers will mean everything fits together snugly.</p>\n<p>Using your 2.5mm spacer and fixings kit, put a screw through the back of the board and then mount a small spacer, then tighten, then mount the item, then add a nut.</p>\n<h3>Making a front cover</h3>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAUCAwT/xAAVAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAABrI4ppgLBP//EABsQAAICAwEAAAAAAAAAAAAAAAABAiIDERIx/9oACAEBAAEFAvUkcMyxpY3I/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8Bqv/EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/AYj/xAAZEAACAwEAAAAAAAAAAAAAAAAAAQIQMUH/2gAIAQEABj8Clba0xHD/xAAeEAACAgICAwAAAAAAAAAAAAABEQBBITFhcaHR8f/aAAgBAQABPyFkvWoxi4n7G4kq6z7hAB2q5weU/9oADAMBAAIAAwAAABAjz//EABURAQEAAAAAAAAAAAAAAAAAABAh/9oACAEDAQE/EIP/xAAVEQEBAAAAAAAAAAAAAAAAAAAQIf/aAAgBAgEBPxCh/8QAHBABAAIDAAMAAAAAAAAAAAAAAQARITFRscHw/9oACAEBAAE/EC3bjtxGpWoShiaiBN6DAdLwHpG+JqW3exL7eZ//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"the front cover protects the wires and boards from front impact\"\n        title=\"the front cover protects the wires and boards from front impact\"\n        src=\"/static/eddbce11234f0572c07646449b36f7e7/1c72d/cover.jpg\"\n        srcset=\"/static/eddbce11234f0572c07646449b36f7e7/a80bd/cover.jpg 148w,\n/static/eddbce11234f0572c07646449b36f7e7/1c91a/cover.jpg 295w,\n/static/eddbce11234f0572c07646449b36f7e7/1c72d/cover.jpg 590w,\n/static/eddbce11234f0572c07646449b36f7e7/a8a14/cover.jpg 885w,\n/static/eddbce11234f0572c07646449b36f7e7/fbd2c/cover.jpg 1180w,\n/static/eddbce11234f0572c07646449b36f7e7/93719/cover.jpg 4000w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">the front cover protects the wires and boards from front impact</figcaption>\n  </figure></p>\n<p>If your backboard won't be going in an enclosure, it's a good idea to mount a front cover to provide impact protection to the items. This also helps keep curious fingers away from wires.</p>\n<p>To do this:</p>\n<ul>\n<li>Cut a piece of clear or translucent acrylic to the same dimensions as the backboard</li>\n<li>Make four holes in each corner of the backboard and front cover</li>\n<li>Put a screw through the backplate, then, using tall spacers from your 3mm standoff kit (you can also use a 2.5mm standoff kit but 3mm is a bit more rugged), make up enough height from the backboard so that the front cover won't crush any wires or items</li>\n<li>For the last standoff, use a female-female spacer so that you can then screw on the front cover with a screw to give a nice finish from the front.</li>\n</ul>\n<p>When your project is done, you can simply screw on the front cover.</p>\n<p>If you want, cut some sides from acrylic and use acrylic weld to glue to the front cover. This way, with the cover off, all sides of the system are accessible for maintenance, but when the cover is on, all sides are protected.</p>\n<h2>Setting up the Pi</h2>\n<h3>Language and frameworks</h3>\n<p>The most logical option for this project was using Javascript, and Node.js:</p>\n<ul>\n<li>JS has a low barrier to entry so makes maintaining easier</li>\n<li>Asynchronous functions are easy - we can use <code class=\"language-text\">setTimeout</code> and have an event-driven script</li>\n<li>There's plenty of packages and libraries for everything from Wiegand to making HTTP requests with Axios.</li>\n</ul>\n<h3>Getting the Pi set up</h3>\n<p>In general steps:</p>\n<ul>\n<li>Set up your pi with Raspberry Pi OS</li>\n<li>Get your Pi connected to WiFi/Ethernet</li>\n<li>SSH into your Pi</li>\n<li>Install Node.js (which also installs npm for installing packages)</li>\n</ul>\n<h3>Cloning the repo</h3>\n<ul>\n<li>Run <code class=\"language-text\">git clone https://github.com/conorriches/doorbotjs.git</code></li>\n<li>This will create a folder called <code class=\"language-text\">doorbotjs</code> with the code in it, but you can specify a different folder if you'd like to in the <code class=\"language-text\">git clone</code> command.</li>\n<li>Change directory to the new folder: <code class=\"language-text\">cd doorbotjs</code></li>\n<li>Install dependencies with <code class=\"language-text\">npm install</code></li>\n</ul>\n<h3>Processes needed</h3>\n<p>We have two processes:</p>\n<ul>\n<li>Access\n<ul>\n<li>This is the main access control script. It monitors inputs, controls outputs, and makes decisions on who or who may not pass.</li>\n</ul>\n</li>\n<li>UpdateMemberList\n<ul>\n<li>This is run as a cron task, that is, it runs every few minutes</li>\n<li>This updates the CSV of allowed people from our central source</li>\n<li>If you don't have a central CSV of users, you can omit this task by deleting it from ecosystem.config.cjs</li>\n<li>If you want to make a script that does update the local allowed-users file, this is where it should be.</li>\n</ul>\n</li>\n</ul>\n<h3>Keeping your script constantly alive</h3>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.567567567567565%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEElEQVQY0wXB60rCYACAYQn6pTl31B108zD9HCqaOG1OU0rcbKZ2EiKIrqC/0X10vW/Pk3P7OypOhKGP0bQJijxEN4ZUgntkbYosTVD0KaoaYnUyLLFHUeb4/ReavVfcakpDnKiO3jFqKTlvuKfsrigUx+SvrskXBqjGGBE/o1sxSmmGosdo2gynv8PuZ2jaCq9zwqpnlNUVTXFEzL/wxIHcIj4TLz9o+Rs8d41ejjDMmN+fP3qDM6ViiF2+RSqGuPMl/nqLU0uIwk98L+Py4hqvlnLIvul1j+REkOG3E4LggVY7xXHvUPQbTCfBMLeoaoQqzZClKVZzTXv0SKudMRi8IbpPmOYG297QqCcY2oJ/Whl5UyPZtTgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"PM2 showing the two processes. Yes my terminal background image is the bird from my birdwatching project.\"\n        title=\"PM2 showing the two processes. Yes my terminal background image is the bird from my birdwatching project.\"\n        src=\"/static/e3b726b5180921af50e1f1ccc014b445/fcda8/pm2.png\"\n        srcset=\"/static/e3b726b5180921af50e1f1ccc014b445/12f09/pm2.png 148w,\n/static/e3b726b5180921af50e1f1ccc014b445/e4a3f/pm2.png 295w,\n/static/e3b726b5180921af50e1f1ccc014b445/fcda8/pm2.png 590w,\n/static/e3b726b5180921af50e1f1ccc014b445/738b8/pm2.png 639w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">PM2 showing the two processes. Yes my terminal background image is the bird from my birdwatching project.</figcaption>\n  </figure>\nSome people may go to great lengths to live forever, fortunately for us, we can keep our script alive by using <code class=\"language-text\">pm2</code>. This should be installed globally using the command:</p>\n<p><code class=\"language-text\">npm install pm2 -g</code></p>\n<p>PM2 is a process manager, and it's job is to run processes, and restart them if they fail. It also provides useful logging and stats on our processes memory requirements with numerous configurations.</p>\n<p>I've created a file <code class=\"language-text\">ecosystem.config.cjs</code> which details the processes we want to run.</p>\n<p>To initialise PM2, simple call:\n<code class=\"language-text\">pm2 start ecosystem.config.cjs</code></p>\n<p>You can then inspect the running processes with the following commands:</p>\n<ul>\n<li><code class=\"language-text\">pm2 logs</code> will show you the various logs, including things logged to console, and error logs</li>\n<li><code class=\"language-text\">pm2 list</code> will show you a list of processes</li>\n<li><code class=\"language-text\">pm2 show &lt;ID></code> will show you detailed stats for a specified process\n<ul>\n<li>ID can be item ID (0,1,etc) or name (access)</li>\n</ul>\n</li>\n<li><code class=\"language-text\">pm2 flush</code> will flush any logs</li>\n<li><code class=\"language-text\">pm2 restart &lt;ID></code> will manually restart a process if you want to make any changes locally (ideal for debugging but make sure to commit any changes!)</li>\n</ul>\n<h2>The code</h2>\n<p>The code for this project <a href=\"https://github.com/conorriches/doorbotjs\">lives on GitHub</a>.</p>\n<p>The general gist of the code is the top level directory contains the main services, and then under <code class=\"language-text\">src</code> are the classes that represent real life things:</p>\n<ul>\n<li>Keypad</li>\n<li>Wiegand</li>\n<li>LCD</li>\n<li>Timed relay</li>\n</ul>\n<p>I've used callbacks as a way to keep the meaty functions in the main file, while exporting all the implementation detail to external files:\nFor example, the Wiegand file is just:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token string\">\"use strict\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> WiegandReader <span class=\"token keyword\">from</span> <span class=\"token string\">\"wiegand-node\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Wiegand</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> pinD0<span class=\"token punctuation\">,</span> pinD1<span class=\"token punctuation\">,</span> validateCallback <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fobReader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WiegandReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">d0</span><span class=\"token operator\">:</span> pinD0<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">d1</span><span class=\"token operator\">:</span> pinD1 <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fobReader<span class=\"token punctuation\">.</span><span class=\"token function\">begin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fobReader<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"reader\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">idDec<span class=\"token punctuation\">,</span> idRFID<span class=\"token punctuation\">,</span> idHex</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">validateCallback</span><span class=\"token punctuation\">(</span>idHex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>This just passes the pins the Wiegand reader is connected to into the library we are using, and passes a callback to the \"reader\" event, returning the fob ID as hex.</p>\n<h3>Validating Entries</h3>\n<p>Things get more interesting in <code class=\"language-text\">access.js</code> when we validate an entry. To keep things consistent, the same function validates both keypad codes and fob codes, with a boolean flag to differentiate between the two.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">entryCodeExistsInMemberlist</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> entryCode<span class=\"token punctuation\">,</span> isKeycode <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"members.csv\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"utf8\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> records</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        records<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">record</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>memberCodeId<span class=\"token punctuation\">,</span> announceName<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> record<span class=\"token punctuation\">;</span>\n\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isKeycode <span class=\"token operator\">&amp;&amp;</span> memberCodeId<span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ff\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>memberCodeId<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> entryCode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                memberCodeId<span class=\"token punctuation\">,</span>\n                announceName\n              <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isKeycode <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>memberCodeId<span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ff\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>memberCodeId<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> entryCode<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                memberCodeId<span class=\"token punctuation\">,</span>\n                announceName\n              <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"no record found\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>We return a Promise which means the calling function won't block, and the resulting behaviour will depend on whether we call either <code class=\"language-text\">reject</code> or <code class=\"language-text\">resolve</code>. If we call <code class=\"language-text\">resolve</code> we pass in an object with the details of the person who entered.</p>\n<p>To work out whether to admit or deny entry:</p>\n<ul>\n<li>We open <code class=\"language-text\">members.csv</code></li>\n<li>Reject our promise if there's an error, this will deny entry</li>\n<li>For each record (which will be in the format of <code class=\"language-text\">fobId, username</code>)\n<ul>\n<li>check whether it's a keypad code or a fob ID</li>\n<li>consider the correct characters of the stored code to what was entered.</li>\n</ul>\n</li>\n</ul>\n<p>The part that may be confusing with the above is how codes are stored. Rather than have a file full of fob IDs and a file full of keypad access codes, it makes sense to combine the file to just one access file that comes from our source of truth.</p>\n<p>To distinguish between keypad codes and fob codes, all keypad codes start with <code class=\"language-text\">ff</code> which no fob ever will, due to the specification on fob IDs.</p>\n<p>E.g.</p>\n<ul>\n<li><code class=\"language-text\">ff12345678</code> will match keypad entry <code class=\"language-text\">12345678</code></li>\n<li><code class=\"language-text\">aabbccdd</code> will match fob <code class=\"language-text\">aabbccdd</code></li>\n</ul>\n<p>Therefore, when we validate some input, we set the <code class=\"language-text\">isKeycode</code> flag accordingly, which then checks if a line starts with <code class=\"language-text\">ff</code> before trying to validate the user input against it.</p>\n<p>Likewise, if scanning a fob, any line starting with <code class=\"language-text\">ff</code> is ignored as it's not a fob code.</p>\n<p><code class=\"language-text\">grantEntry</code> is the bit that fires the lock, and inside is just:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">grantEntry</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  lock<span class=\"token punctuation\">.</span><span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  strike<span class=\"token punctuation\">.</span><span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  led_outside<span class=\"token punctuation\">.</span><span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">duration</span><span class=\"token operator\">:</span> <span class=\"token number\">5000</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> buzzer_outside<span class=\"token punctuation\">.</span><span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">duration</span><span class=\"token operator\">:</span> <span class=\"token number\">50</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> buzzer_outside<span class=\"token punctuation\">.</span><span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">duration</span><span class=\"token operator\">:</span> <span class=\"token number\">50</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> buzzer_outside<span class=\"token punctuation\">.</span><span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">duration</span><span class=\"token operator\">:</span> <span class=\"token number\">50</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">300</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<ul>\n<li><code class=\"language-text\">lock</code> is an instance of <code class=\"language-text\">TimedOutput</code>, and calling <code class=\"language-text\">trigger()</code> will fire it for the time defined at instantiation, in this case 0.5s.</li>\n<li><code class=\"language-text\">strike</code> is the same, but set to fire for 10s</li>\n<li><code class=\"language-text\">led_outside</code> connects to the Wiegand \"LED\" input, which makes the green LED illuminate so the user knows they may enter</li>\n<li>the three <code class=\"language-text\">setTimeout</code> lines are a cheap way to get the outside buzzer (connected to the Wiegand \"Beep\" input) to chirp thrice on success</li>\n</ul>\n<h3>TimedOutput</h3>\n<p>This class aims to simplify the act of having a relay fire for a given amount of time before returning to it's initial state.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token string\">\"use strict\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Gpio <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"onoff\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TimedOutput</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> pin<span class=\"token punctuation\">,</span> duration <span class=\"token operator\">=</span> <span class=\"token number\">50</span> <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>timeout <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>output <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Gpio</span><span class=\"token punctuation\">(</span>pin<span class=\"token punctuation\">,</span> <span class=\"token string\">\"high\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"none\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">activeLow</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>duration <span class=\"token operator\">=</span> duration<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>blocked <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">trigger</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> duration <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> blocking <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>blocked<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>blocking<span class=\"token punctuation\">)</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>blocked <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>timeout<span class=\"token punctuation\">)</span> <span class=\"token function\">clearTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>timeout<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>timeout <span class=\"token operator\">=</span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>timeout <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>blocked <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> duration <span class=\"token operator\">||</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>duration<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>The main parts</p>\n<ul>\n<li>A blocking call means the output will stay on for the specified time and won't accept future triggers until it's done\n<ul>\n<li>e.g. You get denied entry and the buzzer is beeping loudly. Pressing a keypad key (which calls a short pip to the buzzer) should not cancel this long beep out!</li>\n</ul>\n</li>\n<li>If the output is active and not blocked, extend the output so that multiple calls maintain the output state\n<ul>\n<li>e.g. For the Request To Exit button - pressing regularly will keep the lock open, rather than the numerous timeouts firing as the user presses the button multiple times</li>\n</ul>\n</li>\n<li>Set the output to high, and then immediately after set a timeout for it to be set low</li>\n<li>High and Low here are inverted, as we initialised the <code class=\"language-text\">Gpio</code> with <code class=\"language-text\">{ activeLow: true }</code>\n<ul>\n<li>Relay boards are common in design, and will trigger the relay when you <strong>ground</strong> the input wire</li>\n<li>Therefore, the pin being LOW would trigger the relay</li>\n<li>Therefore, we set <code class=\"language-text\">activeLow</code> to true so our logic can refer to High (1) and Low (0) without worrying about this physical implementation detail.</li>\n</ul>\n</li>\n</ul>\n<h3>Notable comments on security</h3>\n<p>The method of checking the fob ID is similar to the existing system, and hasn't been updated in this rebuild, which focuses on reliability and maintainability. In both systems we just check the fob ID.</p>\n<p>Fob IDs can be spoofed in the same way as keypad codes can be randomly entered. Therefore we have two considerations to make:</p>\n<ul>\n<li>Entering an incorrect keypad code or fob ID should block the system to slow down attackers</li>\n<li>If someone is going to that much effort to spoof a fob to get into a hackerspace, they probably belong on the inside anyway!</li>\n</ul>\n<p>The advent of Flipper 0 changes things somewhat as it's now easier for anyone to just start spoofing fob IDs. That's why the next upgrade to the system will be some additional layer of security such as a signed hash so we can more securely prevent people from spoofing fobs.</p>\n<p>However, with hundreds of members, this isn't quick or easy. If starting from scratch, it could be worth investigating how to increase your security, for example by using <a href=\"https://www.npmjs.com/package/mifare-classic\">mifare-classic</a> to write data to the tag upon registration which is then verified on reading.</p>\n<h3>Repo README docs</h3>\n<p>Notable README files live under <code class=\"language-text\">/docs</code>:</p>\n<ul>\n<li><a href=\"https://github.com/conorriches/doorbotjs/blob/main/docs/code.md\">notes on the code</a></li>\n<li><a href=\"https://github.com/conorriches/doorbotjs/blob/main/docs/manual.md\">user manual</a></li>\n<li><a href=\"https://github.com/conorriches/doorbotjs/blob/main/docs/terminology.md\">terminology for people not familiar</a></li>\n<li><a href=\"https://github.com/conorriches/doorbotjs/blob/main/docs/wiring.md\">wiring diagram for getting started</a></li>\n</ul>","frontmatter":{"title":"Making an access control system with Wiegand readers and the Raspberry Pi","date":"December 21, 2022","featuredImage":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAgQA/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQME/9oADAMBAAIQAxAAAAGEh6GjTaR//8QAGhAAAgMBAQAAAAAAAAAAAAAAAAIBERIDIv/aAAgBAQABBQIqbxyMtCo1nqT/xAAVEQEBAAAAAAAAAAAAAAAAAAAQMf/aAAgBAwEBPwGn/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQIBAT8BECf/xAAcEAABBAMBAAAAAAAAAAAAAAAAAREhQRAiUYH/2gAIAQEABj8CkRe1hrSTbwc//8QAHBAAAgMAAwEAAAAAAAAAAAAAAREAITFBUWGB/9oACAEBAAE/IWha+4AKeNRuofYXaqCiR5DQpRD3eZP/2gAMAwEAAgADAAAAELff/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAx/9oACAEDAQE/EHCT/8QAGBEBAQADAAAAAAAAAAAAAAAAAQARIVH/2gAIAQIBAT8QbibnHb//xAAfEAEAAQQBBQAAAAAAAAAAAAABEQAhMUGBUXGhsdH/2gAIAQEAAT8QhaBXE5+eqWARQADk3SyQuy3w0qEuVa2cNWIU7uXXioJMDKMjEs9q/9k=","aspectRatio":1.3333333333333333,"src":"/static/696de9043782b79702cf1e6c3c91a32c/14b42/connections.jpg","srcSet":"/static/696de9043782b79702cf1e6c3c91a32c/f836f/connections.jpg 200w,\n/static/696de9043782b79702cf1e6c3c91a32c/2244e/connections.jpg 400w,\n/static/696de9043782b79702cf1e6c3c91a32c/14b42/connections.jpg 800w,\n/static/696de9043782b79702cf1e6c3c91a32c/47498/connections.jpg 1200w,\n/static/696de9043782b79702cf1e6c3c91a32c/0e329/connections.jpg 1600w,\n/static/696de9043782b79702cf1e6c3c91a32c/d2452/connections.jpg 4000w","sizes":"(max-width: 800px) 100vw, 800px"}}}}}},"pageContext":{"slug":"/blog/access-control/"}},"staticQueryHashes":["3682878853","3729204765"]}